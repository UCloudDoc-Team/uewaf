# 接入UWAF
UWAF是部署在Web服务器前，通过转发代理的方式为业务提供保护的一款产品。通过对流量的内容检测，抵御包括SQL注入，XSS攻击，漏洞攻击，恶意扫描等类型的攻击行为。为网站的正常工作保驾护航。

![](/images/15970482393080.jpg)

接入UWAF前后对比：

![](/images/15970482669463.jpg)

## 1.进入UWAF控制台
登陆UCloud控制台 -> 全部产品 -> 安全防护 -> WEB应用防火墙 UWAF - 开始使用（如未开通请先开通该服务）

![](/images/16062905233652.jpg)



### 参数说明

|参数|说明|
|-|-|
|类型|UWAF部署的区域类型，包含中国内地，港澳台，海外区域以及ULB专区|
|地域|域名配置生成的工作区域|
|版本类型|不同版本UWAF，详细的版本差异，功能、性能对比，请在[版本选择](/uewaf/steer/Version_selection)查看|
|扩展带宽|当版本提供的带宽额度不满足业务需求时，可提供额外的带宽扩展|
|域名扩展包|当版本提供的域名数不满足业务需求时，可提供额外的域名扩展|
|独享IP点数|该IP点数可为用户域名分配一个独享的防御IP，在版本配额外可提供额外的点数|
|IPv6|IPV6扩展包，开启后，添加域名时可额外部署到IPv6区域以提供IPv6访问|
|日志扩展包|提供180天的日志存储与下载服务，满足等保要求，旗舰版及以上免费提供|
|高级功能|除基本Web防护功能外的高级功能，具体说明请在[版本选择](/uewaf/steer/Version_selection?id=功能说明)查看|
|定制化需求|可以按需调整无法在控制台调整的功能，需联系技术支持人员| 


## 2.添加域名
1. 点击【域名管理】-【添加域名】
2. 在弹窗中填写域名和对应域名源站地址，域名可以是泛域名或者完整的子域名。点击【确定】后，在界面上获取生成的CNAME信息。
    ![](/images/16062909081477.jpg)


3. 域名信息展示
    ![](/images/15970491668107.jpg)

!> 注意：  
域名必须是已经备案的，未备案的域名将无法添加。  
海外地区不受备案限制。  

4. HTTPS站点，需要上传站点的HTTPS证书。
![](/images/16062908633019.jpg)

### 参数说明

|参数|说明|
|-|-|
|域名|需要防护的域名|
|源站IP|域名的源站地址，需选择协议类型，填写相应的端口|
|部署区域|域名配置生成的工作区域|
|工作模式|阻断模式：将根据系统规则与用户自定义规则进行拦截和放行，并生成安全日志<br>告警模式：将根据系统规则与用户自定义规则生成安全日志，但是不拦截，此模式CC规则生效<br>放行模式：不会产生任何日志信息，仅做流量转发，所有的访问都将被放行|
|独享防御IP|为该域名分配一个独享的防御IP|
|WAF前是否具有代理|若在UWAF前面使用第三方代理（高防，CDN，PATHX等服务），请求经过代理转发后，UWAF获取不到真实的客户端IP地址。<br>开启该功能并填充可以准确获取客户端真实IP的字段，即可让UWAF获取到真实的客户端IP地址|
|SSL证书|使用HTTPS协议的端口时需要上传相应的证书，如有可匹配的证书则会列出|
|HTTP回源|开启后，来自HTTPS协议443端口的请求会转发至源站80端口，**此项不支持非标端口**|
|HTTPS跳转|开启后，来自HTTTP协议80端口的请求UWAF会返回301让客户端请求HTTPS协议443端口<br>不能同时配置多个HTTP业务转发规则，**此项不支持非标端口**|
|HTTP2转发|开启HTTP/2业务的转发与安全防护，**开启此项需同时开启HTTPS跳转**|


## 3.本地测试
1. 使用ping命令获取CANME对应的IP地址。
![](/images/16062912982683.jpg)
2. 修改客户端的hosts记录，将站点域名指向ping对应CNAME域名所得到的IP地址，这样可以在本地测试流量是否经过UWAF。
```
WINDOWS（xp/2003/vista/2008/7/8）用户HOSTS文件是在 "c:\windows\system32\drivers\etc" 目录
MAC用户HOSTS文件在 "/private/etc/" 目录
打开hosts文件，编辑里面域名前面的IP地址，请替换为cname对应的IP地址。
```
![](/images/16062913664718.jpg)

## 4.修改DNS记录
拿到对应域名的CNAME值后，需要到DNS服务商处添加CNAME记录，将站点的域名正确解析至UWAF提供的CNAME，如您使用 DNSPod 提供的解析服务，则可以到 DNSPod 控制台添加CNAME记录，如下图所示。
![](/images/16062914733087.jpg)

## 5.测试配置是否正确
验证CNAME的解析是否完成，步骤如下：

1. 在Windows操作系统中，选择“开始 \> 运行”，在弹出框中输入“cmd”，按“Enter”。
2. 执行以下命令  ``nslookup （空格） -qt=cname（空格） 域名``
3. 查询CNAME，如果回显的域名是配置的CNAME，则表示配置成功。
![](/images/15970493399116.jpg)


## 6.模式选择
当用户配置完DNS解析后，需要注意查看是否域名已经是阻断模式，如果不是，则需在「防护设置」里选择域名的工作模式为阻断模式。开启UWAF的防护功能。
