# 策略配置

​	本章介绍了API安全的策略配置。在内置检测机制的基础上，API安全支持自定义符合业务特征的检测策略。您可以进行风险识别规则、风险规则、敏感信息规则、MIME解析规则对象配置，使得识别出的API数据更符合您的实际业务情况，进一步提高API安全检测的准确率，帮助您结合业务情况进行相应处置，降低API业务资产遭受攻击带来的损失。

## 一、识别规则配置

​	在 **API 安全** > **策略配置 **>**识别规则**可以针对特定的 API 路径，按照输入的正则表达式进行匹配。禁用API识别规则后，该规则下所自定义规则不生效，默认按系统内置模型进行资产识别。

​	单击**添加规则**，正确配置对应的参数，单击**确定**，即可创建对应检测规则。

![](/images/api-security/identification.png)

​	**字段说明**

- 规则名称：支持自定义输入规则名称。
- 域名：规则应用的域名。
- 匹配逻辑：支持逻辑与和逻辑或两种。
- 匹配动作：识别-记录此资产后续行为；丢弃-此资产行为不被记录。
- 匹配条件：多条匹配规则为逻辑与或者逻辑或的关系，与匹配逻辑选择保持一致。
  - 数据位置：支持匹配请求头、响应头、请求内容、请求查询参数、响应内容、路径、请求方法
  - 逻辑符：支持包含、不包含、等于、不等于、正则匹配
  - 当规则匹配的参数存在编码的情况下，需选择对应的解码方式，如不存在编码情况，请选择默认值不解码，目前仅支持UrlDecode(URL解码)，Base64(BASE64解码)函数。
- 参数提取：匹配规则匹配到的记录通过参数提取规则进行处理；当匹配动作选择为丢弃时，将不进行参数提取。多条规则之间逐一执行。
  - 数据位置：支持提取请求头、响应头、请求内容、请求查询参数、响应内容
  - 数据处理方式：支持存为API名称、提取Header项为参数
  - 数据解码：支持不解码、URL解码、BASE64解码
- 状态：支持开启或禁用该条规则。





## 二、风险规则配置

​	风险是指接口因开发缺陷，或者管理、配置缺陷而导致的安全风险或安全隐患。安全风险与安全事件的区别是，安全风险并不一定代表发生了攻击，而安全事件则代表被攻击产生的告警。

**自定义风险识别策略配置**

​	除了内置策略外，风险识别配置允许您自定义配置自定义策略，自定义策略配置规则如下。

1. 在**API安全**页面，选择**策略配置**＞**风险规则**页签。

2. 单击**添加规则**，在弹出的页面进行相关配置，具体的配置项如下表所示。

   ![](/images/api-security/risk.png)



**字段说明**

- 规则名称：支持自定义输入规则名称。

- 域名：规则应用的域名。

- 风险等级：支持选择高风险、中风险、低风险，标识对应安全事件的风险等级。

- 匹配动作：目前仅支持标记风险

- 匹配逻辑：支持逻辑与和逻辑或两种。

- 匹配条件：多条匹配规则为逻辑与或者逻辑或的关系，与匹配逻辑选择保持一致。

  - 数据位置：支持匹配请求头、响应头、请求内容、请求查询参数、响应内容、请求Cookies、路径、请求方法
  - 逻辑符：支持包含、不包含、等于、不等于、正则匹配

- 状态：支持开启或禁用该条规则。

- 规则描述：自定义输入事件详情，便于区分事件用途和影响。

  

# 三、敏感信息规则

​	如果您在业务中存在自己定义的敏感数据，您可以配置自定义敏感数据检测规则。在API安全页面，选择策略配置＞敏感信息配置页签＞添加规则，可以根据业务场景自定义敏感检测规则，检测请求中是否涉及对应敏感信息。

![](/images/api-security/Sensitive.png)

​	**字段说明**

- 规则名称：支持自定义输入规则名称。
- 域名：规则应用的域名。
- 敏感等级：支持选择高敏感、中敏感、低敏感，标识对应安全事件的敏感等级。
- 匹配条件：目前仅支持正则匹配，多条规则之间为或的关系。
- 状态：支持开启或禁用该条规则。
- 规则描述：自定义输入事件详情，便于区分事件用途和影响。



# 四、MIME解析规则

​	MIME 是一种互联网标准，它扩展了电子邮件标准，使其能够支持非 ASCII 字符文本、二进制文件、音频、视频等多种类型的数据。在网络通信中，MIME 类型（也称为媒体类型）用于标识不同格式的数据。

您可以在API安全页面，选择策略配置＞MIME 解析规则，添加规则对特定的Content-Type指定解析方式。

![](/images/api-security/parsing.png)

​	**字段说明**

- 规则名称：支持自定义输入规则名称。
- 域名：规则应用的域名。
- 内容类型：指定Content-Type类型。
- 解析方法：支持json、url、xml、multipart。
- 状态：支持开启或禁用该条规则。

# 五、 鉴权信息规则

​	如果您在业务中使用了非常规字段作为您的鉴权字段，或者纯数字等特征较弱的鉴权字段名称，推荐您配置自定义鉴权凭据。在系统内置的鉴权凭据识别的基础上，您可以指定参数名，用于辅助内置模型准确识别判断请求中是否携带鉴权凭据，从而提升API安全，以及提高未鉴权风险识别的准确率。

​	您可以在API安全页面，选择策略配置＞鉴权信息规则，添加规则对特定的域名配置用户鉴权的参数，以识别资产是否存在未授权或越权风险。

![](/images/api-security/authentication.png)

**字段说明**

- 规则名称：支持自定义输入规则名称。
- 域名：规则应用的域名。
- 规则类型：根据提取内容存储为相应类型，用于风险检测使用。
- 匹配逻辑：支持逻辑与（and）和逻辑或（or）。
- 匹配条件：多条匹配规则为逻辑与或者逻辑或的关系，与匹配逻辑选择保持一致。
  - 数据位置：支持匹配请求头、响应头、请求内容、请求查询参数、响应内容、请求Cookies、路径、请求方法
  - 逻辑符：支持包含、不包含、等于、不等于、正则匹配

- 参数提取：匹配规则匹配到的记录通过参数提取规则进行处理；当匹配规则不配置时，直接通过参数提取规则提取，多条规则之间逐一执行。
  - 数据位置：支持提取请求头、响应头、请求内容、请求查询参数、响应内容、请求cookies。
  - 逻辑发：目前仅支持正则匹配。
  - 数据解码：支持不解码、URL解码和BASE64解码。
- 状态：支持开启或禁用该条规则。
- 规则描述：支持自定义输入。

# 六、信息维护

​	据自身业务特性进行定制自定义分组用于标识接口的功能用途，API接口的路径特征和参数名特征。

![](/images/api-security/groupping.png)

