# 接入UWAF
UWAF是部署在Web服务器前，通过转发代理的方式为业务提供保护的一款产品。通过对流量的内容检测，抵御包括SQL注入，XSS攻击，漏洞攻击，恶意扫描等类型的攻击行为。为网站的正常工作保驾护航。

![](/images/15970482393080.jpg)

接入UWAF前后对比：

![](/images/15970482669463.jpg)

### 1.进入UWAF控制台
登陆UCloud控制台 -> 全部产品 -> 安全防护 -> WEB应用防火墙 UWAF - 开始使用（如未开通请先开通该服务）

![](/images/16062905233652.jpg)



#### 参数说明：
  - 区域：中国内地，港澳台，海外区域三种产品类型
  - 地域：受保护域名的配置生成区域
  - 版本类型：提供4种版本供用户选择，详细的版本差异，性能对比，请在产品选型查看
  - 扩展带宽：当默认带宽额度不满足客户需求时，可提供额外的带宽补充
  - 扩展域名数：当默认的域名数不满足客户需求时，可提供额外的域名补充
  - 独享IP点数：该IP点数可为用户域名分配一个独享的防御IP
  - IPV6：IPV6扩展包，开启后，可以在部署域名工作区的时候进行配置
  - 日志扩展服务：满足等保需求，存储日志180天（旗舰版以上免费提供）
  - 高级功能：具体的功能对比，请在选品选型查看

### 2.添加域名
1. 点击【域名管理】-【添加域名】
2. 在弹窗中填写域名和对应域名源站地址，域名可以是泛域名或者完整的子域名。点击【确定】后，在界面上获取生成的CNAME信息。
    ![](/images/16062909081477.jpg)


3. 域名信息展示
    ![](/images/15970491668107.jpg)

!> 注意：  
域名必须是已经备案的，未备案的域名将无法添加。  
海外地区不受备案限制。  

4. HTTPS站点，需要上传站点的HTTPS证书。
![](/images/16062908633019.jpg)

#### 参数说明

  - 域名：用户的网站域名
  - 源站IP：对应的网站源站地址 ，协议类型 ，端口设置
  - 部署区域：UWAF域名的配置生成区域
  - 工作模式：三种不同的工作模式
    *   阻断模式：将根据系统规则与用户自定义规则进行拦截和放行，并生成安全日志
    *   告警模式：将根据系统规则与用户自定义规则生成安全日志，但是不拦截
    *   放行模式：不会产生任何日志信息，仅做流量转发。所有的访问都将被放行
  - 独享防御IP：是否为该域名分配一个独享的防御IP
  - WAF前是否具有代理：如果用户在UWAF前面使用了其余第三方代理（高防,CDN,PATHX等服务）,代理在数据转发过程中，内容格式如不符合HTTP/S协议标准，则有可能获取不到用户的真实IP地址。则需要开启该功能，填充可以准确获取客户端真实IP的字段。
  - SSL证书：使用HTTPS协议端口时需要上传相应的证书
  - HTTP回源：当开启HTTPS回源后，来自HTTPS:443端口业务流量会转发至源站80端口，不支持非标端口
  - HTTPS强制跳转：当开启HTTPS跳转后，来自HTTTP:80端口业务流量会转发至源站443端口。不能同时配置多个HTTP的业务转发规则，不支持非标端口

### 3. 本地测试
1. 使用ping命令获取CANME对应的IP地址。
     ![](/images/16062912982683.jpg)
2. 修改客户端的hosts记录，将站点域名指向ping对应CNAME得到的IP地址，这样可以在本地测试流量是否经过UWAF。

    ```
    WINDOWS（xp/2003/vista/2008/7/8）用户HOSTS文件是在“c:\windows\system32\drivers\etc”
    MAC用户HOSTS文件在”/private/etc/“
    打开hosts文件，编辑里面域名后面的IP地址，请替换为cname对应的IP地址。
    ```
![-w501](/images/16062913664718.jpg)

### 4.修改DNS记录
如下图所示，拿到对应域名的CNAME值后，需要到DNS服务商处添加CNAME记录，将站点的域名正确解析至UWAF提供的CNAME。
![](/images/16062914733087.jpg)

### 5.测试配置是否正确
验证CNAME的解析是否完成，步骤如下：

1. 在Windows操作系统中，选择“开始 \> 运行”，在弹出框中输入“cmd”，按“Enter”。
2. 执行以下命令  ``nslookup （空格） -qt=cname（空格） 域名``
3. 查询CNAME，如果回显的域名是配置的CNAME，则表示配置成功。
![](/images/15970493399116.jpg)


### 6.模式选择
当用户配置完DNS解析后，需要注意查看是否域名已经是阻断模式，如果不是，则需要编辑防护设置，选择域名的工作模式为阻断模式。正式开启UWAF的防护功能。
