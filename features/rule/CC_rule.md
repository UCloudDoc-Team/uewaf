# CC 规则

!> 注意：  
CC防护在**阻断模式**和**告警模式**都会生效，如果用户没有配置CC规则，则会有一条默认规则生效，默认规则为单IP 1分钟内请求数不超过500次，此规则在用户没有自定义CC规则时强制开启。如果用户有自定义CC规则，则该条目不生效。

* 正常模式：仅自定义规则生效（无自定义规则的话则只有默认规则生效）。
* 紧急模式：不仅自定义规则会生效，并且系统将根据数据分析、人工智能识别等技术对攻击进行拦截，可能存在误杀，开启后将根据攻击特点进行自动的拦截。并且会对请求加入cookie参数校验功能，如果应用具有301跳转功能，不建议开启紧急模式。


## 自定义CC规则

CC规则列出了用户所有的自定义CC规则。

![cc-rule-img-1](/images/cc-rule-img-1.png)

说明：
 - 时间：定义收集的时间，即统计周期指，默认为10秒
 - 路径：需要防护的网站资源地址或目录，例如 index.html 或 / (根目录)
 - 次数：指访问的次数
 - 动作：指满足条件后系统将会执行的动作
 - 操作：编辑 或 删除

上图的规则表示在10秒内统计周期内访问 /index.html 超过 10 次的IP会触发拦截动作，同时IP将会被加入CC黑名单中。


### 添加规则

参数说明
 - 时间：检测的统计周期
 - 路径：完全匹配 为 等于条件，目标匹配 为 包含条件
 - 次数：次数限制，即在统计周期内访问的阈值，超过会触发相应的动作
 - 动作：
   - 封禁该IP：4层封堵；如前面有CDN等代理，则会封禁建链IP地址，即CDN等代理节点的IP，**导致大面积无法正常访问，请谨慎使用**
   - 拦截此类请求：7层封堵，UWAF会对封禁的IP返回HTTP 444状态码，部分浏览器不能识别444状态码，会显示 connection reset；如前面有CDN等代理，需正确配置「真实IP字段设置」，若CDN等未正确传递该字段可能存在误封
   - 启用验证码：触发CC规则时，则会重定向到验证码页面，如用户验证通过，则会把该IP放白10分钟（不进行CC判断，其他规则判断不受影响）
 - 时长：生效周期，触发CC规则后的封堵时长，超过此时长后该IP会重新进行CC判断

![](/images/15971391299486.jpg)

## CC封堵IP

此处可以看到触发了CC规则的IP列表，包含封禁或者触发验证码的IP。「刷新CC黑名单」会将所有IP取消封禁或验证码验证，而操作一栏的「解封该IP」可以将单个IP取消封禁或验证码验证。

![cc-rule-img-2](/images/cc-rule-img-2.png)

##### CC规则应用示例

对网站开启全站CC防护功能，要求单IP每20秒不能超过50次请求。

###### 规则参考配置如下
![](/images/15971393155084.jpg)


