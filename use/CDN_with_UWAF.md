# CDN结合UWAF

?> 说明：  
基于SaaS版UWAF。

Web应用防火墙（UWAF），可以与网宿、加速乐、七牛、又拍、阿里云、UCloud等CDN结合使用，对使用了CDN的站点进行WEB应用层的安全防护。

## 部署架构：
![](/images/15970530493441.jpg)

## 1.进入UWAF界面
登陆UCloud控制台，从产品列表中选择UWAF：【全部产品】 -> 【安全防护】 -> 【WEB应用防火墙 UWAF】，再点击【开始使用】（如未开通请先开通该服务）。

## 2.添加域名
在UWAF控制台的【域名管理】标签页中中点击【添加域名】，在弹窗中填写站点域名，源站IP等信息，域名可以是泛域名或者完整的子域名。点击【确定】后，在界面上获取生成的CNAME信息。
![](/images/15970530944743.jpg)

!> 注意：  
域名必须是已经备案的，未备案的域名将无法添加。  
海外地区不受备案限制。  
如果防护的是HTTPS站点，需要上传站点的SSL证书。若是从[USSL](/ussl/operate/buy)购买的证书或者证书托管在[USSL](/ussl/operate/upload)，则在添加HTTPS站点时会自动拉取相应域名的证书。

## 3.修改CDN回源域名
修改CDN回源到UWAF生成的CNAME，如果使用的是UCloud的UCDN云分发服务，则如下面流程所示进行修改：  
控制台左上方【全部产品】-> 【云分发 UCDN】-> 【域名管理】-> 选中某一个域名 -> 点击【详情】->【域名配置】->【基础设置】->修改【源站】为从UWAF控制台得到的CNAME防护域名。

### 注意：
1. 选中的域名要与UWAF中添加的域名一致
2. 源站填写UWAF生成的CNAME
3. 如果CDN不是从XFF传递的真实客户IP，则有可能导致用户的CDN建邻IP会被误封
   ![](/images/15970531105872.jpg)

