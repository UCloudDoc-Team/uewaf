# HTTPS/证书相关问题

## 开启HTTPS访问
有两种方式：
1. 添加支持HTTPS协议的源站并上传对应域名的SSL证书。如需将HTTP请求重定向为HTTPS请求，请开启「HTTPS跳转」选项，仅支持80端口重定向到443端口。
2. 添加端口为443的HTTPS协议源站后，开启「HTTP回源」选项，仅支持443端口回源到80端口，源站需开放80端口。


## 移动设备HTTPS访问异常
通常该问题出现在移动端浏览器（例如安卓系统预装浏览器、微信小程序）访问HTTPS网站时出现，原因是部分移动端浏览器会校验网站的SSL证书以及中间证书，如果缺少中间证书，则无法访问网站，而UWAF上查询不到此类访问日志。 

### 解决方案

1. 可以在证书颁发机构下载中间证书，使用文本编辑器或 `cat` 命令将中间证书内容追加在公钥文件内容之后，将包含了中间证书的公钥文件上传。
2. 通过第三方工具（推荐使用 ``https://myssl.com/chain_download.html`` ）补齐中间证书并下载包含完整证书链的证书，然后上传。
3. 联系UCloud技术支持，后台添加中间证书。


## SSL证书格式
UWAF支持PEM格式的证书（可通过UCloud USSL证书购买，下载PEM格式证书文件），通常PEM格式的证书包含两个文件，文件后缀为pem的是公钥文件，选择公钥文件后点击「上传公钥」按钮上传，文件后缀为key（也有可能文件后缀也是pem，可通过文件名区分公私钥）的是私钥文件，选择私钥文件后点击「上传私钥」按钮上传。

文件上传后，UWAF会检验证书的正确性，如果检验不通过将返回错误且无法应用该证书，请按如下步骤进行排查后重新上传：
1. 公钥文件和私钥文件是否正确。
2. 上传的文件是否重复。
3. 可以通过第三方工具验证证书是否正确（推荐使用 ``https://myssl.com/match_key.html``）。

如果SSL证书是从USSL购买或托管于其，UWAF支持自动同步此类证书。

## SSL客户端验证
UWAF支持HTTPS域名配置客户端验证，如果您有这方面需求，请联系UCloud技术支持。并请准备好验证根证书，CRT证书。
